<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Virtual Keyboard for GoTTY</title>
  <style>
    /* Basic Styling */
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    iframe {
      width: 100vw;
      height: 100vh;
      border: none;
    }
    .keyboard-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
      flex-grow: 1;
    }
    .key {
      width: 5vw;
      height: 5vh;
      margin: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f1f1f1;
      border: 1px solid #ccc;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1.5em;
      transition: background-color 0.3s;
    }
    .key:hover {
      background: #e0e0e0;
    }
    .key.special {
      background: #ffcc00;
    }
    .key.switch {
      background: #99cc99;
    }
    .bottom-row {
      display: flex;
      justify-content: center;
      margin-top: 10px;
      width: 100%;
    }
    .control-row {
      display: flex;
      justify-content: center;
      margin-top: 10px;
      width: 100%;
    }

    /* Toggle Button Styling */
    .toggle-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
  </style>
</head>
<body>
  <!-- GoTTY embedded in iframe -->
  <iframe id="terminalFrame" src="https://backendconsole2468.serveo.net" title="GoTTY Terminal"></iframe>

  <!-- Keyboard UI -->
  <div class="keyboard-container" id="keyboard"></div>

  <div class="control-row">
    <!-- Always visible control keys (Enter, Backspace, Shift, Ctrl, Alt) -->
    <div class="key special" id="shift">⬇️</div>
    <div class="key special" id="ctrl">Ctrl</div>
    <div class="key special" id="alt">Alt</div>
    <div class="key special" id="enter">⤵️</div>
    <div class="key special" id="backspace">⬅️</div>
  </div>

  <!-- Toggle Button for Keyboard -->
  <div class="toggle-button" id="toggleKeyboardBtn">KB</div>

  <!-- JavaScript -->
  <script>
    // Alphabetical and Special Characters
    const alphabetKeys = [
      ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'],
      ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l'],
      ['z', 'x', 'c', 'v', 'b', 'n', 'm'],
      [' '], // Removed Enter/Backspace from here
    ];

    const specialKeys = [
      ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0'],
      ['!', '"', '#', '$', '%', '&', "'", '(', ')'],
      ['*', '+', ',', '-', '.', '/', ':', ';', '<', '=', '>', '?'],
      ['[', '\\', ']', '^', '_', '`', '{', '|', '}', '~'],
    ];

    let isCapsLock = false; // Track the Caps Lock state
    let isShiftPressed = false; // Track the Shift key state
    let usingSpecialKeys = false; // Track whether we're in special characters mode

    // Function to create the keyboard UI
    const createKeyboard = () => {
      const keyboardContainer = document.getElementById('keyboard');
      // Add button to switch between alphabetic and special keys
      const toggleButton = document.createElement('div');
      toggleButton.classList.add('key', 'switch');
      toggleButton.textContent = "ABC/Special";
      toggleButton.onclick = toggleKeyboardMode;
      keyboardContainer.appendChild(toggleButton);

      // Create rows of keys (alphabetical or special)
      const keysToUse = usingSpecialKeys ? specialKeys : alphabetKeys;
      keysToUse.forEach(row => {
        row.forEach(key => {
          const keyButton = document.createElement('div');
          keyButton.classList.add('key');
          keyButton.textContent = key;

          // Regular key behavior
          keyButton.onclick = () => sendKey(key);
          keyboardContainer.appendChild(keyButton);
        });
      });
    };

    // Toggle between special characters and alphabet mode
    const toggleKeyboardMode = () => {
      usingSpecialKeys = !usingSpecialKeys; // Toggle the mode
      // Recreate the keyboard with the new mode
      document.getElementById('keyboard').innerHTML = ''; // Clear previous keyboard
      createKeyboard(); // Rebuild keyboard
    };

    // Function to handle special keys like Shift, Caps, etc.
    const handleSpecialKey = (key) => {
      if (key === 'Shift') {
        isShiftPressed = !isShiftPressed; // Toggle shift state
        console.log('Shift pressed:', isShiftPressed);
      } else if (key === 'Caps') {
        isCapsLock = !isCapsLock; // Toggle Caps Lock
        console.log('Caps Lock:', isCapsLock);
      } else if (key === 'Backspace') {
        sendKey('Backspace');
      } else if (key === 'Enter') {
        sendKey('Enter');
      }
    };

    // Function to send the key press to the iframe
    const sendKey = (char) => {
      const iframe = document.getElementById('terminalFrame');
      const termDoc = iframe.contentWindow.document;

      let keyToSend = char;

      // Handle shift/caps behavior
      if (isShiftPressed || isCapsLock) {
        keyToSend = keyToSend.toUpperCase(); // Convert to uppercase if shift or caps is pressed
      }

      const event = new KeyboardEvent('keydown', {
        key: keyToSend,
        bubbles: true
      });

      termDoc.dispatchEvent(event);
    };

    // Initialize the keyboard
    createKeyboard();

    // Add toggle button functionality to show/hide the keyboard
    const toggleButton = document.getElementById('toggleKeyboardBtn');
    const keyboardContainer = document.getElementById('keyboard');

    toggleButton.onclick = () => {
      if (keyboardContainer.style.display === 'none' || keyboardContainer.style.display === '') {
        keyboardContainer.style.display = 'flex';
      } else {
        keyboardContainer.style.display = 'none';
      }
    };
  </script>
</body>
</html>